{"version":3,"sources":["webpack:///./_js/src/pro/toc.js"],"names":["stylesheetReady","isLarge$","fromMediaQuery","window","matchMedia","BREAK_POINT_DYNAMIC","pipe","startWith","map","m","matches","pushState","document","getElementById","toc$","fromEvent","querySelector","share","combineLatest","switchMap","toc","isLarge","NEVER","offsetTop","rem","passive","getScrollTop","x","distinctUntilChanged","tap","affix","classList","add","remove","finalize","subscribe","intersecting","Set","top","WeakMap","toObserve","Array","from","querySelectorAll","el","children","getAttribute","hash","substr","filter","init","createIntersectionObservable","entries","forEach","target","boundingClientRect","set","isIntersecting","delete","curr","reduce","min","get","style","fontWeight","id"],"mappings":"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","file":"LEGACY-toc-hydejack-9.0.0-beta.1.js","sourcesContent":["// Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport { fromEvent, NEVER, combineLatest } from 'rxjs';\nimport { map, tap, switchMap, distinctUntilChanged, startWith, share, finalize } from 'rxjs/operators';\n\nimport { BREAK_POINT_DYNAMIC, getScrollTop, rem, createIntersectionObservable, stylesheetReady, fromMediaQuery } from '../common';\n\n(async () => {\n  await stylesheetReady;\n\n  const isLarge$ = fromMediaQuery(window.matchMedia(BREAK_POINT_DYNAMIC)).pipe(\n    startWith(window.matchMedia(BREAK_POINT_DYNAMIC)),\n    map(m => m.matches),\n  );\n\n  const pushState = document.getElementById('_pushState');\n  if (!pushState) return;\n\n  const toc$ = fromEvent(pushState, 'load').pipe(\n    map(() => document.querySelector('.no-break-layout #markdown-toc')),\n    share(),\n  );\n\n  combineLatest(toc$, isLarge$).pipe(\n    switchMap(([toc, isLarge]) => {\n      if (!toc || !isLarge) return NEVER;\n\n      const offsetTop = toc.offsetTop - rem(1);\n\n      return fromEvent(document, 'scroll', { passive: true }).pipe(\n        map(getScrollTop),\n        startWith(getScrollTop()),\n        map((x) => x >= offsetTop),\n        distinctUntilChanged(),\n        tap((affix) => {\n          if (affix) {\n            toc.classList.add('affix');\n          } else {\n            toc.classList.remove('affix');\n          }\n        }),\n        finalize(() => {\n          toc.classList.remove('affix');\n        }),\n      );\n    }),\n  ).subscribe();\n\n  combineLatest(toc$, isLarge$).pipe(\n    switchMap(([toc, isLarge]) => {\n      if (!toc || !isLarge) return NEVER;\n\n      const intersecting = new Set();\n      const top = new WeakMap();\n\n      const toObserve = Array.from(toc.querySelectorAll('li'))\n        .map((el) => el.children[0].getAttribute('href') || '')\n        .map((hash) => document.getElementById(hash.substr(1)))\n        .filter((el) => !!el);\n\n      let init = true;\n      return createIntersectionObservable(toObserve).pipe(\n        tap((entries) => {\n          if (init) {\n            entries.forEach(({ target, boundingClientRect }) =>\n              top.set(target, getScrollTop() + boundingClientRect.top),\n            );\n            init = false;\n          }\n\n          entries.forEach(({ isIntersecting, target }) => {\n            isIntersecting ? intersecting.add(target) : intersecting.delete(target);\n          });\n\n          const curr = Array.from(intersecting).reduce((min, el) => (top.get(el) >= top.get(min) ? min : el), null);\n          if (curr) {\n            toc.querySelectorAll('a').forEach((el) => { el.style.fontWeight = '' });\n            const el = toc.querySelector(`a[href=\"#${curr.id}\"]`);\n            if (el) el.style.fontWeight = 'bold';\n          }\n        }),\n        finalize(() => {\n          toc.querySelectorAll('a').forEach((el) => { el.style.fontWeight = '' });\n        }),\n      );\n    }),\n  ).subscribe();\n})();\n"],"sourceRoot":""}