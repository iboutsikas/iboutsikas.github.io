{"version":3,"sources":["webpack:///./_js/src/pro/search.js"],"names":["SEL_NAVBAR_BTN_BAR","stylesheetReady","pushStateEl","document","getElementById","searchFrag","importTemplate","workerHref","href","navbarEl","querySelector","searchBtnEl","searchBoxEl","hitsEl","children","insertBefore","searchInputEl","searchCloseEl","addEventListener","focus","select","classList","add","value","style","display","closeHandler","activeElement","blur","remove","once","worker","Worker","prevVal","fromEvent","pipe","tap","e","target","keyCode","preventDefault","switchMap","postMessage","items","length","render","html","repeat","item","url","assign","image","title","description","subscribe"],"mappings":"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","file":"search-hydejack-9.0.0-rc.js","sourcesContent":["// Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nimport { fromEvent } from 'rxjs';\nimport { tap, switchMap } from 'rxjs/operators';\nimport { render, html } from 'lit-html';\nimport { repeat } from 'lit-html/directives/repeat';\n\nimport { importTemplate, postMessage, once, stylesheetReady } from '../common';\n\nconst SEL_NAVBAR_BTN_BAR = '#_navbar > .content > .nav-btn-bar';\n\n(async () => {\n  await stylesheetReady;\n\n  const pushStateEl = document.getElementById('_pushState');\n\n  const searchFrag = importTemplate('_search-template');\n  const workerHref = document.getElementById('_hrefSearch')?.href;\n  if (searchFrag && workerHref) {\n    const navbarEl = document.querySelector(SEL_NAVBAR_BTN_BAR);\n    const [searchBtnEl, searchBoxEl, hitsEl] = searchFrag.children;\n    if (!searchBtnEl || !searchBoxEl || !hitsEl || !navbarEl) return;\n\n    navbarEl.insertBefore(searchBtnEl, navbarEl.querySelector('.nav-span'));\n    navbarEl.insertBefore(searchBoxEl, navbarEl.querySelector('.nav-span'));\n    navbarEl.insertBefore(hitsEl, navbarEl.querySelector('.nav-span'));\n\n    const searchInputEl = searchBoxEl.querySelector('input[type=search]');\n    const searchCloseEl = searchBoxEl.querySelector('button[type=reset]');\n    if (!searchInputEl || !searchCloseEl) return;\n\n    searchBtnEl.addEventListener('click', () => {\n      searchInputEl.focus();\n    });\n\n    searchInputEl.addEventListener('focus', () => {\n      searchInputEl.select();\n      searchBoxEl.classList.add('show');\n      if (searchInputEl.value !== '') hitsEl.style.display = '';\n    });\n\n    const closeHandler = () => {\n      document.activeElement?.blur();\n      searchBoxEl.classList.remove('show');\n      hitsEl.style.display = 'none';\n    };\n\n    hitsEl.style.display = 'none';\n\n    searchCloseEl.addEventListener('click', closeHandler);\n    pushStateEl?.addEventListener('hy-push-state-start', closeHandler);\n\n    // Load search worker after user interaction\n    await once(document, 'click');\n    const worker = new Worker(workerHref);\n    let prevVal = '';\n    fromEvent(searchInputEl, 'keyup')\n      .pipe(\n        tap((e) => {\n          if (e.target.value === '' && prevVal === '' && e.keyCode === 27) {\n            e.preventDefault();\n            closeHandler();\n          }\n          prevVal = e.target.value;\n        }),\n        switchMap((e) => postMessage(worker, e.target.value)),\n        tap((items) => {\n          if (items.length) {\n            render(\n              html`\n                <ul>\n                  ${repeat(\n                    items,\n                    (item) => item.url,\n                    (item) => html`\n                      <li class=\"search-item\" @click=${() => pushStateEl?.assign?.(item.url)}>\n                        <div class=\"search-img aspect-ratio sixteen-ten\">\n                          ${item.image ? html` <img src=\"${item.image}\" /> ` : ''}\n                        </div>\n                        <div class=\"search-text\">\n                          <p>\n                            <a class=\"heading\" href=${item.url}>${item.title}</a>\n                            <small>${item.url}</small>\n                          </p>\n                          ${item.description ? html` <p>${item.description}</p> ` : ''}\n                        </div>\n                      </li>\n                    `,\n                  )}\n                </ul>\n              `,\n              hitsEl,\n            );\n            hitsEl.style.display = '';\n          } else {\n            hitsEl.style.display = 'none';\n          }\n        }),\n      )\n      .subscribe();\n  }\n})();\n"],"sourceRoot":""}