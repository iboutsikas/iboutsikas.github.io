---
---
{% unless site.hydejack.no_search or jekyll.incremental %}
{% assign pages = site.pages | where_exp:"page","page.title != null" | where_exp:"page","page.sitemap != false" %}
{
  "pages": [
    {% for page in pages %}{
      {% capture image %}{% if page.image %}{% include smart-url url=page.image %}{% endif %}{% endcapture %}
      {% if image            %}"image": {{       image            | jsonify }},{% endif %}
      {% if page.title       %}"title": {{       page.title       | jsonify }},{% endif %}
      {% if page.description %}"description": {{ page.description | markdownify | strip_html | jsonify }},{% endif %}
      {% if page.content     %}"content": {{     page.content     | markdownify | strip_html | jsonify }},{% endif %}
      "url": {{                                  page.url         | relative_url | jsonify }}
    }{% unless forloop.last %},{% endunless %}{% endfor %}
  ], 
  "documents": [
    {% for doc in site.documents %}{
      {% capture image %}{% if doc.image %}{% include smart-url url=doc.image %}{% endif %}{% endcapture %}
      {% if image           %}"image": {{       image           | jsonify }},{% endif %}
      {% if doc.title       %}"title": {{       doc.title       | jsonify }},{% endif %}
      {% if doc.date        %}"date": {{        doc.date        | jsonify }},{% endif %}
      {% if doc.description %}"description": {{ doc.description | markdownify | strip_html | jsonify }},{% endif %}
      {% if doc.content     %}"content": {{     doc.content     | markdownify | strip_html | jsonify }},{% endif %}
      {% if doc.categories  %}"categories": {{  doc.categories  | jsonify }},{% endif %}
      {% if doc.tags        %}"tags": {{        doc.tags        | jsonify }},{% endif %}
      {% if doc.keywords    %}"keywords": {{    doc.keywords    | jsonify }},{% endif %}
      "collection": {{                          doc.collection  | jsonify }},
      "url": {{                                 doc.url         | relative_url | jsonify }}
    }{% unless forloop.last %},{% endunless %}{% endfor %}
  ]
}
{% else %}{}{% endunless %}
